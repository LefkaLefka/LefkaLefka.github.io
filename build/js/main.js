(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
var movement_1 = require("../ts/modules/movement");
var game_1 = require("../ts/modules/game");
var game = new game_1.Game();
new movement_1.Movement(game);
},{"../ts/modules/game":2,"../ts/modules/movement":3}],2:[function(require,module,exports){
"use strict";
var Game = (function () {
    /**
     * Constructor of game, where set main array and players score.
     */
    function Game() {
        this.sizeField = 3;
        // 1 - x, 0 - o, -1 - null.
        this.field = [[0, 0, 0],
            [0, 0, 0],
            [0, 0, 0]];
        this.score = {
            player1: 0,
            player2: 0
        };
        this.startGame();
    }
    Game.prototype.startGame = function () {
        if (Math.random() > 0.5) {
            this.players = {
                player1: "x",
                player2: "o",
            };
            // Player1 start the game.
            this.whoseMove = 0;
        }
        else {
            this.players = {
                player1: "o",
                player2: "x",
            };
            // Player2 start the game.
            this.whoseMove = 1;
        }
        this.countOfMove = 0;
    };
    Game.prototype.check = function () {
        // если есть еще куда ходить
        if (this.countOfMove <= (this.sizeField * this.sizeField)) {
            // если больше 5 ходов
            if (this.countOfMove >= 5) {
                var horizontal = void 0, vertical = void 0, 
                // диагональ вида \
                diagonalL = void 0, 
                // диагональ вида /
                diagonalR = void 0;
                // проверяем на выиграш
                for (var i = 0; i < this.sizeField; ++i) {
                    horizontal = 0;
                    vertical = 0;
                    diagonalL = 0;
                    diagonalR = 0;
                    for (var j = 0; j < this.sizeField; ++j) {
                        // проверяем горизонтали
                        horizontal += this.field[i][j];
                        // проверяем вертикали
                        vertical += this.field[j][i];
                        // диагональ направо
                        diagonalL += this.field[j][j];
                        // диагональ налево
                        diagonalR += this.field[j][this.sizeField - j - 1];
                    }
                    // если в горизонтале насчитали 3 илли -3 возвращаем горизонталь
                    // если в горизонтале нет ничего подобного проверяем вертикаль по такому же принципу
                    // если ничего не нашли проверяем диагональ \
                    // если ничего не нашли проверяем диагональ /
                    // в других случаях(нет выигравшего) возврщаем ноль
                    var temp = Math.abs(horizontal) === this.sizeField ?
                        horizontal : Math.abs(vertical) === this.sizeField ?
                        vertical : Math.abs(diagonalL) === this.sizeField ?
                        diagonalL : Math.abs(diagonalR) === this.sizeField ?
                        diagonalR : 0;
                    // если есть победитель
                    if (temp != 0) {
                        if (temp > 0) {
                            if (this.players.player1 === "x") {
                                this.score = {
                                    player1: this.score.player1 + 1,
                                    player2: this.score.player2,
                                };
                            }
                            else {
                                this.score = {
                                    player1: this.score.player1,
                                    player2: this.score.player2 + 1,
                                };
                            }
                        }
                        return true;
                    }
                }
            }
            // если клеток на поле не осталось
            if (this.countOfMove === (this.sizeField * this.sizeField)) {
                return false;
            }
        }
    };
    /**
     * Function to handle the move player.
     * @param i Coordinates for x.
     * @param j Coordinates for y.
     * @returns {any} Boolean : false - when cell is busy. String : "o" | "x" - when cell is free.
     */
    Game.prototype.move = function (i, j) {
        if (this.field[i][j] === 0) {
            // Fill the array.
            this.field[i][j] = this.whoseMove === 0 ?
                (this.players.player1 === "x" ? 1 : -1) :
                (this.players.player2 === "x" ? 1 : -1); // Select "x" or "o" for set in array player2 moves
            // If we made move increasing counter.
            ++this.countOfMove;
            // Check for win.
            if (this.check()) {
                this.render();
            }
            // Change next player.
            this.whoseMove ^= 1;
            // this.whoseMove === 1 - invert, because we change next player above.
            return this.whoseMove === 1 ? this.players.player1 : this.players.player2;
        }
        else {
            return false;
        }
    };
    Game.prototype.render = function () {
        $("[data-player1]").text("Player 1: " + this.score.player1);
        $("[data-player2]").text("Player 2: " + this.score.player2);
    };
    return Game;
}());
exports.Game = Game;
// отобразить кто ходит крестиками кто ноликами
},{}],3:[function(require,module,exports){
"use strict";
var Movement = (function () {
    /**
     * Constructor.
     * @param _game Class where defined "game rules".
     */
    function Movement(_game) {
        // u - up, d - down, l - left, r - right, s - set
        //                     u   d   l   r   s
        this.keyCodes = [87, 83, 65, 68, 90,
            38, 40, 37, 39, 48, 96, 45]; // arrow
        this.index = 4;
        this.initElements();
        this.game = _game;
    }
    /**
     * Init element for set event listener.
     */
    Movement.prototype.initElements = function () {
        var _this = this;
        // Init elements.
        this.elements = {
            cells: $("[data-cell]"),
            body: $("body")
        };
        // Set event listener.
        this.elements.cells.each(function (i, el) {
            _this.listenClick(el, _this.click, _this);
        });
        this.listenKeyUp(this.elements.body, this.moving, this);
    };
    /**
     * Set click event listener.
     * @param el Element for set event listener.
     * @param callback Function for processing.
     * @param context Context of "Movement".
     */
    Movement.prototype.listenClick = function (el, callback, context) {
        var _this = this;
        $(el).on("click", function (eventObject) {
            _this.elements.cells.each(function (i, el) {
                if (el === eventObject.target) {
                    callback(i, context, eventObject.target);
                }
            });
        });
    };
    /**
     * Set keyUp event listener.
     * @param el Element for set event listener.
     * @param callback Function for processing.
     * @param context Context of "Movement".
     */
    Movement.prototype.listenKeyUp = function (el, callback, context) {
        $(el).on("keyup", function (e) {
            callback(e.keyCode, context);
        });
    };
    /**
     * When click on element.
     */
    Movement.prototype.click = function (index, context, el) {
        // Find index in array.
        var i = Math.floor(index / context.game.sizeField), j = index - context.game.sizeField * i, 
        // Find result of a player's turn.
        result = context.game.move(i, j);
        // If result correct - show.
        if (result !== false) {
            $(el).text(result);
        }
    };
    /**
     * When move to element.
     * @param keyCode Key code of pressed button.
     */
    Movement.prototype.moving = function (keyCode, context) {
        for (var _i = 0, _a = context.keyCodes; _i < _a.length; _i++) {
            var code = _a[_i];
            if (keyCode === code) {
                // up
                if ((keyCode === 87) || (keyCode === 38)) {
                    context.checkIndex(-3, context);
                }
                // down
                if ((keyCode === 83) || (keyCode === 40)) {
                    context.checkIndex(3, context);
                }
                // left
                if ((keyCode === 65) || (keyCode === 37)) {
                    context.checkIndex(-1, context);
                }
                // right
                if ((keyCode === 68) || (keyCode === 39)) {
                    context.checkIndex(1, context);
                }
                // set
                if ((keyCode === 90) || (keyCode === 48) || (keyCode === 96) || (keyCode === 45)) {
                    // "UnShow" previous element.
                    context.unRender(context.index);
                    // Find index in array.
                    var i = Math.floor(context.index / context.game.sizeField), j = context.index - context.game.sizeField * i, 
                    // Find result of a player's turn.
                    result = context.game.move(i, j);
                    // If result correct - show.
                    if (result !== false) {
                        $(context.elements.cells[context.index]).text(result);
                    }
                    // Set default value.
                    context.index = 4;
                }
                break;
            }
        }
    };
    /**
     * Check index
     * @param shift The number of shifts.
     * @param context Context of "Movement".
     */
    Movement.prototype.checkIndex = function (shift, context) {
        // If index is within the bounds [0..8] - 9 elements.
        if (context.index + shift < 9 && context.index + shift >= 0) {
            // "UnShow" previous selected element.
            context.unRender(context.index);
            // Find new index.
            context.index += shift;
            // Show new element.
            context.render(context.index);
        }
    };
    /**
     * Show element with index.
     * @param index Index of showing element.
     */
    Movement.prototype.render = function (index) {
        $(this.elements.cells[index]).addClass("selected");
    };
    /**
     * "UnShow" element with index.
     * @param index Index of showing element.
     */
    Movement.prototype.unRender = function (index) {
        $(this.elements.cells[index]).removeClass("selected");
    };
    return Movement;
}());
exports.Movement = Movement;
},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvdHMvbWFpbi50cyIsInNyYy90cy9tb2R1bGVzL2dhbWUudHMiLCJzcmMvdHMvbW9kdWxlcy9tb3ZlbWVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7QUNBQSxtREFBaUQ7QUFDakQsMkNBQXlDO0FBRXpDLElBQUksSUFBSSxHQUFVLElBQUksV0FBSSxFQUFFLENBQUM7QUFDN0IsSUFBSSxtQkFBUSxDQUFDLElBQUksQ0FBQyxDQUFDOzs7QUNPbkI7SUFTSTs7T0FFRztJQUNIO1FBVEEsY0FBUyxHQUFZLENBQUMsQ0FBQztRQVVuQiwyQkFBMkI7UUFDM0IsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDVCxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ1QsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekIsSUFBSSxDQUFDLEtBQUssR0FBRztZQUNULE9BQU8sRUFBRyxDQUFDO1lBQ1gsT0FBTyxFQUFHLENBQUM7U0FDZCxDQUFDO1FBQ0YsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ3JCLENBQUM7SUFDTyx3QkFBUyxHQUFqQjtRQUNJLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3JCLElBQUksQ0FBQyxPQUFPLEdBQUc7Z0JBQ1gsT0FBTyxFQUFHLEdBQUc7Z0JBQ2IsT0FBTyxFQUFHLEdBQUc7YUFDaEIsQ0FBQztZQUNGLDBCQUEwQjtZQUMxQixJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQztRQUN2QixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDSixJQUFJLENBQUMsT0FBTyxHQUFHO2dCQUNYLE9BQU8sRUFBRyxHQUFHO2dCQUNiLE9BQU8s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LENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBQ0Q7OztPQUdHO0lBQ0ssMkJBQVEsR0FBaEIsVUFBaUIsS0FBYztRQUMzQixDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDMUQsQ0FBQztJQUNMLGVBQUM7QUFBRCxDQWhKQSxBQWdKQyxJQUFBO0FBaEpZLDRCQUFRIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImltcG9ydCB7IE1vdmVtZW50IH0gZnJvbSBcIi4uL3RzL21vZHVsZXMvbW92ZW1lbnRcIlxyXG5pbXBvcnQgeyBHYW1lIH0gZnJvbSBcIi4uL3RzL21vZHVsZXMvZ2FtZVwiXHJcblxyXG5sZXQgZ2FtZSA6IEdhbWUgPSBuZXcgR2FtZSgpO1xyXG5uZXcgTW92ZW1lbnQoZ2FtZSk7IiwiLyoqXHJcbiAqIEludGVyZmFjZSBmb3Igc2V0IHBsYXllcnMgc2NvcmUuXHJcbiAqL1xyXG5pbnRlcmZhY2UgU2NvcmUge1xyXG4gICAgcGxheWVyMSA6IG51bWJlcjtcclxuICAgIHBsYXllcjIgOiBudW1iZXI7XHJcbn1cclxuaW50ZXJmYWNlIFBsYXllcnMge1xyXG4gICAgcGxheWVyMSA6IHN0cmluZztcclxuICAgIHBsYXllcjIgOiBzdHJpbmc7XHJcbn1cclxuZXhwb3J0IGNsYXNzIEdhbWUge1xyXG4gICAgLy8gMSAtIHgsIC0xIC0gbywgMCAtIG51bGwuXHJcbiAgICBmaWVsZCA6IG51bWJlcltdW107XHJcbiAgICBzaXplRmllbGQgOiBudW1iZXIgPSAzO1xyXG4gICAgc2NvcmUgOiBTY29yZTtcclxuICAgIHBsYXllcnMgOiBQbGF5ZXJzO1xyXG4gICAgLy8gcGxheWVyMSAtIDAsIHBsYXllcjIgLSAxLlxyXG4gICAgd2hvc2VNb3ZlIDogbnVtYmVyO1xyXG4gICAgY291bnRPZk1vdmUgOiBudW1iZXI7XHJcbiAgICAvKipcclxuICAgICAqIENvbnN0cnVjdG9yIG9mIGdhbWUsIHdoZXJlIHNldCBtYWluIGFycmF5IGFuZCBwbGF5ZXJzIHNjb3JlLlxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICAvLyAxIC0geCwgMCAtIG8sIC0xIC0gbnVsbC5cclxuICAgICAgICB0aGlzLmZpZWxkID0gW1swLCAwLCAwXSxcclxuICAgICAgICAgICAgICAgICAgICAgIFswLCAwLCAwXSxcclxuICAgICAgICAgICAgICAgICAgICAgIFswLCAwLCAwXV07XHJcbiAgICAgICAgdGhpcy5zY29yZSA9IHtcclxuICAgICAgICAgICAgcGxheWVyMSA6IDAsXHJcbiAgICAgICAgICAgIHBsYXllcjIgOiAwXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnN0YXJ0R2FtZSgpO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBzdGFydEdhbWUoKSB7XHJcbiAgICAgICAgaWYoTWF0aC5yYW5kb20oKSA+IDAuNSkge1xyXG4gICAgICAgICAgICB0aGlzLnBsYXllcnMgPSB7XHJcbiAgICAgICAgICAgICAgICBwbGF5ZXIxIDogXCJ4XCIsXHJcbiAgICAgICAgICAgICAgICBwbGF5ZXIyIDogXCJvXCIsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIC8vIFBsYXllcjEgc3RhcnQgdGhlIGdhbWUuXHJcbiAgICAgICAgICAgIHRoaXMud2hvc2VNb3ZlID0gMDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnBsYXllcnMgPSB7XHJcbiAgICAgICAgICAgICAgICBwbGF5ZXIxIDogXCJvXCIsXHJcbiAgICAgICAgICAgICAgICBwbGF5ZXIyIDogXCJ4XCIsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIC8vIFBsYXllcjIgc3RhcnQgdGhlIGdhbWUuXHJcbiAgICAgICAgICAgIHRoaXMud2hvc2VNb3ZlID0gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jb3VudE9mTW92ZSA9IDA7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGNoZWNrKCkgOiBib29sZWFuIHwgc3RyaW5nIHtcclxuICAgICAgICAvLyDQtdGB0LvQuCDQtdGB0YLRjCDQtdGJ0LUg0LrRg9C00LAg0YXQvtC00LjRgtGMXHJcbiAgICAgICAgaWYgKHRoaXMuY291bnRPZk1vdmUgPD0gKHRoaXMuc2l6ZUZpZWxkICogdGhpcy5zaXplRmllbGQpKSB7XHJcbiAgICAgICAgICAgIC8vINC10YHQu9C4INCx0L7Qu9GM0YjQtSA1INGF0L7QtNC+0LJcclxuICAgICAgICAgICAgaWYgKHRoaXMuY291bnRPZk1vdmUgPj0gNSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGhvcml6b250YWwgOiBudW1iZXIsIHZlcnRpY2FsIDogbnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgICAgIC8vINC00LjQsNCz0L7QvdCw0LvRjCDQstC40LTQsCBcXFxyXG4gICAgICAgICAgICAgICAgICAgIGRpYWdvbmFsTCA6IG51bWJlcixcclxuICAgICAgICAgICAgICAgICAgICAvLyDQtNC40LDQs9C+0L3QsNC70Ywg0LLQuNC00LAgL1xyXG4gICAgICAgICAgICAgICAgICAgIGRpYWdvbmFsUiA6IG51bWJlcjtcclxuICAgICAgICAgICAgICAgIC8vINC/0YDQvtCy0LXRgNGP0LXQvCDQvdCwINCy0YvQuNCz0YDQsNGIXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2l6ZUZpZWxkOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICBob3Jpem9udGFsID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB2ZXJ0aWNhbCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgZGlhZ29uYWxMID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBkaWFnb25hbFIgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5zaXplRmllbGQ7ICsraikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDQv9GA0L7QstC10YDRj9C10Lwg0LPQvtGA0LjQt9C+0L3RgtCw0LvQuFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBob3Jpem9udGFsICs9IHRoaXMuZmllbGRbaV1bal07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vINC/0YDQvtCy0LXRgNGP0LXQvCDQstC10YDRgtC40LrQsNC70LhcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmVydGljYWwgKz0gdGhpcy5maWVsZFtqXVtpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g0LTQuNCw0LPQvtC90LDQu9GMINC90LDQv9GA0LDQstC+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWdvbmFsTCArPSB0aGlzLmZpZWxkW2pdW2pdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDQtNC40LDQs9C+0L3QsNC70Ywg0L3QsNC70LXQstC+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWdvbmFsUiArPSB0aGlzLmZpZWxkW2pdW3RoaXMuc2l6ZUZpZWxkIC0gaiAtIDFdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g0LXRgdC70Lgg0LIg0LPQvtGA0LjQt9C+0L3RgtCw0LvQtSDQvdCw0YHRh9C40YLQsNC70LggMyDQuNC70LvQuCAtMyDQstC+0LfQstGA0LDRidCw0LXQvCDQs9C+0YDQuNC30L7QvdGC0LDQu9GMXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g0LXRgdC70Lgg0LIg0LPQvtGA0LjQt9C+0L3RgtCw0LvQtSDQvdC10YIg0L3QuNGH0LXQs9C+INC/0L7QtNC+0LHQvdC+0LPQviDQv9GA0L7QstC10YDRj9C10Lwg0LLQtdGA0YLQuNC60LDQu9GMINC/0L4g0YLQsNC60L7QvNGDINC20LUg0L/RgNC40L3RhtC40L/Rg1xyXG4gICAgICAgICAgICAgICAgICAgIC8vINC10YHQu9C4INC90LjRh9C10LPQviDQvdC1INC90LDRiNC70Lgg0L/RgNC+0LLQtdGA0Y/QtdC8INC00LjQsNCz0L7QvdCw0LvRjCBcXFxyXG4gICAgICAgICAgICAgICAgICAgIC8vINC10YHQu9C4INC90LjRh9C10LPQviDQvdC1INC90LDRiNC70Lgg0L/RgNC+0LLQtdGA0Y/QtdC8INC00LjQsNCz0L7QvdCw0LvRjCAvXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g0LIg0LTRgNGD0LPQuNGFINGB0LvRg9GH0LDRj9GFKNC90LXRgiDQstGL0LjQs9GA0LDQstGI0LXQs9C+KSDQstC+0LfQstGA0YnQsNC10Lwg0L3QvtC70YxcclxuICAgICAgICAgICAgICAgICAgICBsZXQgdGVtcCA9IE1hdGguYWJzKGhvcml6b250YWwpID09PSB0aGlzLnNpemVGaWVsZCA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhvcml6b250YWwgOiBNYXRoLmFicyh2ZXJ0aWNhbCkgPT09IHRoaXMuc2l6ZUZpZWxkID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmVydGljYWwgOiBNYXRoLmFicyhkaWFnb25hbEwpID09PSB0aGlzLnNpemVGaWVsZCA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWdvbmFsTCA6IE1hdGguYWJzKGRpYWdvbmFsUikgPT09IHRoaXMuc2l6ZUZpZWxkID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlhZ29uYWxSIDogMDtcclxuICAgICAgICAgICAgICAgICAgICAvLyDQtdGB0LvQuCDQtdGB0YLRjCDQv9C+0LHQtdC00LjRgtC10LvRjFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wICE9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYodGVtcCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMucGxheWVycy5wbGF5ZXIxID09PSBcInhcIiApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjb3JlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIxIDogdGhpcy5zY29yZS5wbGF5ZXIxICsgMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyMiA6IHRoaXMuc2NvcmUucGxheWVyMixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjb3JlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIxIDogdGhpcy5zY29yZS5wbGF5ZXIxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIyIDogdGhpcy5zY29yZS5wbGF5ZXIyICsgMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDQtdGB0LvQuCDQutC70LXRgtC+0Log0L3QsCDQv9C+0LvQtSDQvdC1INC+0YHRgtCw0LvQvtGB0YxcclxuICAgICAgICAgICAgaWYgKHRoaXMuY291bnRPZk1vdmUgPT09ICh0aGlzLnNpemVGaWVsZCAqIHRoaXMuc2l6ZUZpZWxkKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBGdW5jdGlvbiB0byBoYW5kbGUgdGhlIG1vdmUgcGxheWVyLlxyXG4gICAgICogQHBhcmFtIGkgQ29vcmRpbmF0ZXMgZm9yIHguXHJcbiAgICAgKiBAcGFyYW0gaiBDb29yZGluYXRlcyBmb3IgeS5cclxuICAgICAqIEByZXR1cm5zIHthbnl9IEJvb2xlYW4gOiBmYWxzZSAtIHdoZW4gY2VsbCBpcyBidXN5LiBTdHJpbmcgOiBcIm9cIiB8IFwieFwiIC0gd2hlbiBjZWxsIGlzIGZyZWUuXHJcbiAgICAgKi9cclxuICAgIG1vdmUoaSA6IG51bWJlciwgaiA6IG51bWJlcikgOiBib29sZWFuIHwgc3RyaW5nIHtcclxuICAgICAgICBpZih0aGlzLmZpZWxkW2ldW2pdID09PSAwKSB7XHJcbiAgICAgICAgICAgIC8vIEZpbGwgdGhlIGFycmF5LlxyXG4gICAgICAgICAgICB0aGlzLmZpZWxkW2ldW2pdID0gdGhpcy53aG9zZU1vdmUgPT09IDAgPyAvLyBTZWxlY3QgcGxheWVyXHJcbiAgICAgICAgICAgICAgICAodGhpcy5wbGF5ZXJzLnBsYXllcjEgPT09IFwieFwiID8gMSA6IC0xKSA6IC8vIFNlbGVjdCBcInhcIiBvciBcIm9cIiBmb3Igc2V0IGluIGFycmF5IHBsYXllcjEgbW92ZXNcclxuICAgICAgICAgICAgICAgICh0aGlzLnBsYXllcnMucGxheWVyMiA9PT0gXCJ4XCIgPyAxIDogLTEpOyAvLyBTZWxlY3QgXCJ4XCIgb3IgXCJvXCIgZm9yIHNldCBpbiBhcnJheSBwbGF5ZXIyIG1vdmVzXHJcbiAgICAgICAgICAgIC8vIElmIHdlIG1hZGUgbW92ZSBpbmNyZWFzaW5nIGNvdW50ZXIuXHJcbiAgICAgICAgICAgICsrdGhpcy5jb3VudE9mTW92ZTtcclxuICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIHdpbi5cclxuICAgICAgICAgICAgaWYodGhpcy5jaGVjaygpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcigpO1xyXG4gICAgICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuc3RhcnRHYW1lKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gQ2hhbmdlIG5leHQgcGxheWVyLlxyXG4gICAgICAgICAgICB0aGlzLndob3NlTW92ZSBePSAxO1xyXG4gICAgICAgICAgICAvLyB0aGlzLndob3NlTW92ZSA9PT0gMSAtIGludmVydCwgYmVjYXVzZSB3ZSBjaGFuZ2UgbmV4dCBwbGF5ZXIgYWJvdmUuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLndob3NlTW92ZSA9PT0gMSA/IHRoaXMucGxheWVycy5wbGF5ZXIxIDogdGhpcy5wbGF5ZXJzLnBsYXllcjI7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJlbmRlcigpIHtcclxuICAgICAgICAkKFwiW2RhdGEtcGxheWVyMV1cIikudGV4dChcIlBsYXllciAxOiBcIiArIHRoaXMuc2NvcmUucGxheWVyMSk7XHJcbiAgICAgICAgJChcIltkYXRhLXBsYXllcjJdXCIpLnRleHQoXCJQbGF5ZXIgMjogXCIgKyB0aGlzLnNjb3JlLnBsYXllcjIpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vLyDQvtGC0L7QsdGA0LDQt9C40YLRjCDQutGC0L4g0YXQvtC00LjRgiDQutGA0LXRgdGC0LjQutCw0LzQuCDQutGC0L4g0L3QvtC70LjQutCw0LzQuFxyXG4iLCJpbXBvcnQgeyBHYW1lIH0gZnJvbSBcIi4uL21vZHVsZXMvZ2FtZVwiXHJcblxyXG5pbnRlcmZhY2UgRWxlbWVudHMge1xyXG4gICAgY2VsbHMgOiBKUXVlcnk7XHJcbiAgICBib2R5IDogSlF1ZXJ5O1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgTW92ZW1lbnQge1xyXG4gICAgZ2FtZSA6IEdhbWU7XHJcbiAgICBlbGVtZW50cyA6IEVsZW1lbnRzO1xyXG4gICAgLy8gdSAtIHVwLCBkIC0gZG93biwgbCAtIGxlZnQsIHIgLSByaWdodCwgcyAtIHNldFxyXG4gICAgLy8gICAgICAgICAgICAgICAgICAgICB1ICAgZCAgIGwgICByICAgc1xyXG4gICAga2V5Q29kZXMgOiBudW1iZXJbXSA9IFs4NywgODMsIDY1LCA2OCwgOTAsIC8vIHdhc2RcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgMzgsIDQwLCAzNywgMzksIDQ4LCA5NiwgNDVdOyAvLyBhcnJvd1xyXG4gICAgaW5kZXggOiBudW1iZXIgPSA0O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDb25zdHJ1Y3Rvci5cclxuICAgICAqIEBwYXJhbSBfZ2FtZSBDbGFzcyB3aGVyZSBkZWZpbmVkIFwiZ2FtZSBydWxlc1wiLlxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3RvcihfZ2FtZSA6IEdhbWUpIHtcclxuICAgICAgICB0aGlzLmluaXRFbGVtZW50cygpO1xyXG4gICAgICAgIHRoaXMuZ2FtZSA9IF9nYW1lO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBJbml0IGVsZW1lbnQgZm9yIHNldCBldmVudCBsaXN0ZW5lci5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBpbml0RWxlbWVudHMoKSB7XHJcbiAgICAgICAgLy8gSW5pdCBlbGVtZW50cy5cclxuICAgICAgICB0aGlzLmVsZW1lbnRzID0ge1xyXG4gICAgICAgICAgICBjZWxscyA6ICQoXCJbZGF0YS1jZWxsXVwiKSxcclxuICAgICAgICAgICAgYm9keSA6ICQoXCJib2R5XCIpXHJcbiAgICAgICAgfTtcclxuICAgICAgICAvLyBTZXQgZXZlbnQgbGlzdGVuZXIuXHJcbiAgICAgICAgdGhpcy5lbGVtZW50cy5jZWxscy5lYWNoKChpLCBlbCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmxpc3RlbkNsaWNrKGVsLCB0aGlzLmNsaWNrLCB0aGlzKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmxpc3RlbktleVVwKHRoaXMuZWxlbWVudHMuYm9keSwgdGhpcy5tb3ZpbmcsIHRoaXMpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXQgY2xpY2sgZXZlbnQgbGlzdGVuZXIuXHJcbiAgICAgKiBAcGFyYW0gZWwgRWxlbWVudCBmb3Igc2V0IGV2ZW50IGxpc3RlbmVyLlxyXG4gICAgICogQHBhcmFtIGNhbGxiYWNrIEZ1bmN0aW9uIGZvciBwcm9jZXNzaW5nLlxyXG4gICAgICogQHBhcmFtIGNvbnRleHQgQ29udGV4dCBvZiBcIk1vdmVtZW50XCIuXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgbGlzdGVuQ2xpY2soZWwgOiBPYmplY3QsIGNhbGxiYWNrIDogYW55LCBjb250ZXh0IDogYW55KSB7XHJcbiAgICAgICAgJChlbCkub24oXCJjbGlja1wiLCAoZXZlbnRPYmplY3QgOiBKUXVlcnlFdmVudE9iamVjdCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzLmNlbGxzLmVhY2goKGksIGVsKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZihlbCA9PT0gZXZlbnRPYmplY3QudGFyZ2V0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soaSwgY29udGV4dCwgZXZlbnRPYmplY3QudGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFNldCBrZXlVcCBldmVudCBsaXN0ZW5lci5cclxuICAgICAqIEBwYXJhbSBlbCBFbGVtZW50IGZvciBzZXQgZXZlbnQgbGlzdGVuZXIuXHJcbiAgICAgKiBAcGFyYW0gY2FsbGJhY2sgRnVuY3Rpb24gZm9yIHByb2Nlc3NpbmcuXHJcbiAgICAgKiBAcGFyYW0gY29udGV4dCBDb250ZXh0IG9mIFwiTW92ZW1lbnRcIi5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBsaXN0ZW5LZXlVcChlbCA6IE9iamVjdCwgY2FsbGJhY2sgOiBhbnksIGNvbnRleHQgOiBhbnkpIHtcclxuICAgICAgICAkKGVsKS5vbihcImtleXVwXCIsIChlIDogSlF1ZXJ5RXZlbnRPYmplY3QpID0+IHtcclxuICAgICAgICAgICAgY2FsbGJhY2soZS5rZXlDb2RlLCBjb250ZXh0KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogV2hlbiBjbGljayBvbiBlbGVtZW50LlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGNsaWNrKGluZGV4OiBudW1iZXIsIGNvbnRleHQgOiBhbnksIGVsIDogT2JqZWN0KSB7XHJcbiAgICAgICAgLy8gRmluZCBpbmRleCBpbiBhcnJheS5cclxuICAgICAgICBsZXQgaSA6IG51bWJlciA9IE1hdGguZmxvb3IoaW5kZXggLyBjb250ZXh0LmdhbWUuc2l6ZUZpZWxkKSxcclxuICAgICAgICAgICAgaiA6IG51bWJlciA9IGluZGV4IC0gY29udGV4dC5nYW1lLnNpemVGaWVsZCAqIGksXHJcbiAgICAgICAgICAgIC8vIEZpbmQgcmVzdWx0IG9mIGEgcGxheWVyJ3MgdHVybi5cclxuICAgICAgICAgICAgcmVzdWx0IDogYW55ID0gY29udGV4dC5nYW1lLm1vdmUoaSwgaik7XHJcbiAgICAgICAgLy8gSWYgcmVzdWx0IGNvcnJlY3QgLSBzaG93LlxyXG4gICAgICAgIGlmKHJlc3VsdCAhPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgJChlbCkudGV4dChyZXN1bHQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogV2hlbiBtb3ZlIHRvIGVsZW1lbnQuXHJcbiAgICAgKiBAcGFyYW0ga2V5Q29kZSBLZXkgY29kZSBvZiBwcmVzc2VkIGJ1dHRvbi5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBtb3Zpbmcoa2V5Q29kZSA6IG51bWJlciwgY29udGV4dCA6IGFueSkge1xyXG4gICAgICAgIGZvcihsZXQgY29kZSBvZiBjb250ZXh0LmtleUNvZGVzKSB7XHJcbiAgICAgICAgICAgIGlmKGtleUNvZGUgPT09IGNvZGUpIHtcclxuICAgICAgICAgICAgICAgIC8vIHVwXHJcbiAgICAgICAgICAgICAgICBpZigoa2V5Q29kZSA9PT0gODcpIHx8IChrZXlDb2RlID09PSAzOCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmNoZWNrSW5kZXgoLTMsIGNvbnRleHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gZG93blxyXG4gICAgICAgICAgICAgICAgaWYoKGtleUNvZGUgPT09IDgzKSB8fCAoa2V5Q29kZSA9PT0gNDApKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5jaGVja0luZGV4KDMsIGNvbnRleHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gbGVmdFxyXG4gICAgICAgICAgICAgICAgaWYoKGtleUNvZGUgPT09IDY1KSB8fCAoa2V5Q29kZSA9PT0gMzcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5jaGVja0luZGV4KC0xLCBjb250ZXh0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIHJpZ2h0XHJcbiAgICAgICAgICAgICAgICBpZigoa2V5Q29kZSA9PT0gNjgpIHx8IChrZXlDb2RlID09PSAzOSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmNoZWNrSW5kZXgoMSwgY29udGV4dCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBzZXRcclxuICAgICAgICAgICAgICAgIGlmKChrZXlDb2RlID09PSA5MCkgfHwgKGtleUNvZGUgPT09IDQ4KSB8fCAoa2V5Q29kZSA9PT0gOTYpIHx8IChrZXlDb2RlID09PSA0NSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBcIlVuU2hvd1wiIHByZXZpb3VzIGVsZW1lbnQuXHJcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dC51blJlbmRlcihjb250ZXh0LmluZGV4KTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBGaW5kIGluZGV4IGluIGFycmF5LlxyXG4gICAgICAgICAgICAgICAgICAgIGxldCBpIDogbnVtYmVyID0gTWF0aC5mbG9vcihjb250ZXh0LmluZGV4IC8gY29udGV4dC5nYW1lLnNpemVGaWVsZCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGogOiBudW1iZXIgPSBjb250ZXh0LmluZGV4IC0gY29udGV4dC5nYW1lLnNpemVGaWVsZCAqIGksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpbmQgcmVzdWx0IG9mIGEgcGxheWVyJ3MgdHVybi5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0IDogYW55ID0gY29udGV4dC5nYW1lLm1vdmUoaSwgaik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgcmVzdWx0IGNvcnJlY3QgLSBzaG93LlxyXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdCAhPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJChjb250ZXh0LmVsZW1lbnRzLmNlbGxzW2NvbnRleHQuaW5kZXhdKS50ZXh0KHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFNldCBkZWZhdWx0IHZhbHVlLlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRleHQuaW5kZXggPSA0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENoZWNrIGluZGV4XHJcbiAgICAgKiBAcGFyYW0gc2hpZnQgVGhlIG51bWJlciBvZiBzaGlmdHMuXHJcbiAgICAgKiBAcGFyYW0gY29udGV4dCBDb250ZXh0IG9mIFwiTW92ZW1lbnRcIi5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBjaGVja0luZGV4KHNoaWZ0IDogbnVtYmVyLCBjb250ZXh0IDogYW55KSB7XHJcbiAgICAgICAgLy8gSWYgaW5kZXggaXMgd2l0aGluIHRoZSBib3VuZHMgWzAuLjhdIC0gOSBlbGVtZW50cy5cclxuICAgICAgICBpZihjb250ZXh0LmluZGV4ICsgc2hpZnQgPCA5ICYmIGNvbnRleHQuaW5kZXggKyBzaGlmdCA+PSAwKSB7XHJcbiAgICAgICAgICAgIC8vIFwiVW5TaG93XCIgcHJldmlvdXMgc2VsZWN0ZWQgZWxlbWVudC5cclxuICAgICAgICAgICAgY29udGV4dC51blJlbmRlcihjb250ZXh0LmluZGV4KTtcclxuICAgICAgICAgICAgLy8gRmluZCBuZXcgaW5kZXguXHJcbiAgICAgICAgICAgIGNvbnRleHQuaW5kZXggKz0gc2hpZnQ7XHJcbiAgICAgICAgICAgIC8vIFNob3cgbmV3IGVsZW1lbnQuXHJcbiAgICAgICAgICAgIGNvbnRleHQucmVuZGVyKGNvbnRleHQuaW5kZXgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogU2hvdyBlbGVtZW50IHdpdGggaW5kZXguXHJcbiAgICAgKiBAcGFyYW0gaW5kZXggSW5kZXggb2Ygc2hvd2luZyBlbGVtZW50LlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHJlbmRlcihpbmRleCA6IG51bWJlcikge1xyXG4gICAgICAgICQodGhpcy5lbGVtZW50cy5jZWxsc1tpbmRleF0pLmFkZENsYXNzKFwic2VsZWN0ZWRcIik7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFwiVW5TaG93XCIgZWxlbWVudCB3aXRoIGluZGV4LlxyXG4gICAgICogQHBhcmFtIGluZGV4IEluZGV4IG9mIHNob3dpbmcgZWxlbWVudC5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSB1blJlbmRlcihpbmRleCA6IG51bWJlcikge1xyXG4gICAgICAgICQodGhpcy5lbGVtZW50cy5jZWxsc1tpbmRleF0pLnJlbW92ZUNsYXNzKFwic2VsZWN0ZWRcIik7XHJcbiAgICB9XHJcbn0iXX0=
